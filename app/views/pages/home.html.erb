<div class="container-standard">
  <h1 class="page-title">My dashboard</h1>
  <div class="dashboard">
    <div class="dashboard-card">
      <h2>events</h2>
      <div class="search-actions d-flex mt-4">
        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#addTask"> + Add Event </button>
      </div>
      <div style="width: 100%">
        <%= form_with method: :get, class: "search" do %>
          <%= text_field_tag :query,
            params[:query],
            class: "search-bar",
            placeholder: "Search..."
          %>
        <% end %>
      </div>
      <% @events.each do |event| %>
        <%= link_to event_path(event), style: "width: 100%" do %>
          <div class="event-card">
            <div class="event-card-image">
              <% if event.photo.attached?  %>
                <%= cl_image_tag event.photo.key, height: 125, width: 145, crop: :fill %>
              <% end %>
            </div>
            <div class="event-card-content">
              <h5> <%= event.name %></h5>
              <p><%= event.start_date.strftime("%d %B %Y") %></p>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="modal fade" id="addTask" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="addTaskLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addTaskLabel">Create Event</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <%= simple_form_for(@event) do |f| %>
              <%= f.input :name, placeholder: "Event Name", label: "Event Name" %>
              <%= f.input :description, placeholder: "About Event", label: "Event Description" %>
              <div class="flex-inputs">
                <div class="row">
                  <div class="col">
                    <%= f.input :start_date, as: :string,
                      label: "Start Date",
                      placeholder: "Start Date",
                      wrapper_html: { class: "mb-4" },
                      label_html: { class: "form-label text-secondary fw-bold" },
                      input_html: { data: { controller: "flatpickr" } } %>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <%= f.input :end_date, as: :string,
                        label: "End Date",
                        placeholder: "End Date",
                        wrapper_html: { class: "mb-4" },
                        label_html: { class: "form-label text-secondary fw-bold" },
                        input_html: { data: { controller: "flatpickr" } } %>
                  </div>
                </div>
              </div>
              <div class="flex-inputs">
                <%= f.input :venue_name, placeholder: "Venue", label: "Venue" %>
                <%= f.input :venue_address, placeholder: "Address..", label: "Address" %>
              </div>
                <div class="flex-inputs">
                  <%= f.input :est_guests, placeholder: "Estimated Guests", label: "Estimated Guests" %>
                  <%= f.input :total_budget, placeholder: "Budget", label: "Budget" %>
                </div>
                <%= f.input :photo, as: :file, input_html: {  data: { photo_preview_target: "input", action:"change->photo-preview#displayPreview" }}, label_html: { class: 'image-input'}, label: 'Upload file'%>
                <%= f.button :button, "Create Event", class: "btn btn-secondary", label: false  %>
            <% end %>
          </div>
        </div>
      </div>
  </div>
    <div class="dashboard-card">
          <h2>tasks</h2>
          <% if @grouped_tasks.empty? %>
            <div class="todo-card">
            <p> You have no tasks!!! </p>
            </div>
          <% else %>
            <% @grouped_tasks.each do |day, tasks| %>
            <div class="todo-card">
              <h5 class="mb-3"><%=day%></h5>
              <ul>
                <% tasks.each do |task|%>
                  <li><%= task.name.capitalize%> - <em><%=(task.event.name)%></em></li>
                <% end %>
              </ul>
            </div>
            <% end %>
          <% end %>
    </div>

    <div class="d-flex flex-column">

      <div class="dashboard-card mb-5" style="width: 400px">
            <h2>calendar</h2>
            <div class="todo-card">
              <%= image_tag("calendar_image.png", width: 330 ) %>
            </div>
      </div>

      <div class="dashboard-card" style="width: 400px; height:300px">
            <h2>notes</h2>
            <div class="todo-card">
              <h5>Monday</h5>
            </div>
      </div>
    </div>
</div>
